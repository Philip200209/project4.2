<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Officer Workspace - CRIMAP</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-gradient: radial-gradient(circle at 12% 10%, rgba(67,97,238,0.25) 0%, rgba(67,97,238,0) 45%),
                            radial-gradient(circle at 85% 8%, rgba(236,143,106,0.25) 0%, rgba(236,143,106,0) 50%),
                            linear-gradient(135deg, #101524 0%, #1b253b 55%, #142f57 100%);
            --glass: rgba(255,255,255,0.16);
            --card: rgba(15,23,42,0.72);
            --border: rgba(255,255,255,0.12);
            --primary: #4c82ff;
            --primary-soft: rgba(76,130,255,0.18);
            --accent: #ec8f6a;
            --success: #2ec4b6;
            --warning: #ffd166;
            --danger: #ef476f;
            --text: #e6ecff;
            --text-muted: #99a3c7;
            --shadow: 0 32px 60px rgba(7,14,35,0.38);
            --radius-lg: 26px;
            --radius-md: 18px;
            --radius-sm: 12px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', 'Segoe UI', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            color: var(--text);
            padding: clamp(18px, 3vw, 34px);
        }

        a { color: inherit; text-decoration: none; }

        .app-shell {
            max-width: 1380px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: clamp(18px, 3vw, 30px);
        }

        .sidebar {
            background: linear-gradient(160deg, rgba(18,28,49,0.85), rgba(18,28,49,0.65));
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            padding: 30px 26px;
            display: grid;
            gap: 30px;
            backdrop-filter: blur(18px);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .brand-icon {
            width: 46px;
            height: 46px;
            border-radius: 14px;
            background: linear-gradient(135deg, rgba(76,130,255,0.8), rgba(236,143,106,0.8));
            display: grid;
            place-items: center;
            font-size: 1.3rem;
        }

        .brand h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.25rem;
            font-weight: 600;
            letter-spacing: 0.02em;
        }

        .nav-section {
            display: grid;
            gap: 10px;
        }

        .nav-label { font-size: 0.78rem; text-transform: uppercase; letter-spacing: 0.18em; color: var(--text-muted); }

        .nav-link {
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: 14px;
            padding: 14px 16px;
            border-radius: var(--radius-md);
            color: var(--text-muted);
            position: relative;
            border: 1px solid transparent;
            transition: transform 0.25s ease, border 0.25s ease, color 0.25s ease;
        }

        .nav-link i { font-size: 1rem; }

        .nav-link span { font-size: 0.95rem; font-weight: 500; }

        .nav-link[data-active="true"],
        .nav-link:hover {
            color: var(--text);
            border-color: var(--border);
            background: rgba(76,130,255,0.12);
            transform: translateX(4px);
        }

        .nav-count {
            font-size: 0.75rem;
            padding: 3px 9px;
            border-radius: 999px;
            background: rgba(255,255,255,0.08);
            color: var(--text-muted);
        }

        .sidebar-footer {
            margin-top: auto;
            padding-top: 12px;
            border-top: 1px solid rgba(255,255,255,0.06);
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .main {
            display: grid;
            gap: clamp(22px, 4vw, 36px);
        }

        .page-header {
            background: linear-gradient(135deg, rgba(18,28,49,0.92), rgba(18,28,49,0.78));
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            padding: clamp(24px, 4vw, 40px);
            display: grid;
            gap: clamp(24px, 4vw, 30px);
            position: relative;
            overflow: hidden;
        }

        .page-header::after {
            content: '';
            position: absolute;
            inset: auto -40% -45% 55%;
            background: radial-gradient(circle, rgba(76,130,255,0.35), transparent 65%);
            pointer-events: none;
        }

        .header-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 24px;
            position: relative;
            z-index: 2;
        }

        .header-title h2 {
            font-family: 'Poppins', sans-serif;
            font-size: clamp(1.8rem, 4vw, 2.6rem);
            font-weight: 600;
            margin-bottom: 6px;
        }

        .header-title p { color: var(--text-muted); font-size: 0.95rem; }

        .header-meta {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .role-chip {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 999px;
            font-size: 0.85rem;
            font-weight: 600;
            background: rgba(76,130,255,0.14);
            border: 1px solid rgba(76,130,255,0.28);
        }

        .header-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .header-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            border-radius: 14px;
            font-weight: 600;
            font-size: 0.95rem;
            border: 1px solid rgba(255,255,255,0.18);
            background: rgba(255,255,255,0.06);
            color: var(--text);
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
        }

        .header-btn.primary { background: linear-gradient(135deg, #4c82ff, #7aa6ff); border: none; box-shadow: 0 15px 25px rgba(76,130,255,0.25); }

        .header-btn:hover { transform: translateY(-2px); box-shadow: 0 12px 25px rgba(14,25,45,0.35); }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: clamp(16px, 3vw, 24px);
        }

        .insight-card {
            background: var(--card);
            border-radius: var(--radius-md);
            padding: 24px 22px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            display: grid;
            gap: 18px;
            position: relative;
            overflow: hidden;
        }

        .insight-card::after {
            content: '';
            position: absolute;
            inset: -55% 55% 50% -40%;
            background: radial-gradient(circle, rgba(76,130,255,0.18), transparent 72%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .insight-card:hover::after { opacity: 1; }

        .insight-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .insight-icon {
            width: 42px;
            height: 42px;
            border-radius: 14px;
            display: grid;
            place-items: center;
            background: rgba(76,130,255,0.2);
            color: #bcd3ff;
            font-size: 1.1rem;
        }

        .insight-card.pending .insight-icon { background: rgba(255,209,102,0.2); color: #ffd166; }
        .insight-card.approved .insight-icon { background: rgba(46,196,182,0.2); color: #63dfd2; }
        .insight-card.risk .insight-icon { background: rgba(239,71,111,0.2); color: #ff8da8; }

        .insight-title { font-size: 0.86rem; text-transform: uppercase; letter-spacing: 0.14em; color: var(--text-muted); }

        .insight-value { font-size: clamp(1.6rem, 3vw, 2.4rem); font-weight: 700; font-family: 'Poppins', sans-serif; }

        .insight-meta { font-size: 0.85rem; color: var(--text-muted); display: flex; justify-content: space-between; align-items: center; gap: 10px; }

        .progress {
            width: 100%;
            height: 6px;
            border-radius: 999px;
            background: rgba(255,255,255,0.08);
            overflow: hidden;
        }

        .progress span {
            display: block;
            height: 100%;
            border-radius: 999px;
            background: linear-gradient(135deg, #4c82ff, #78a6ff);
            width: var(--percent, 0%);
        }

        .insight-card.pending .progress span { background: linear-gradient(135deg, #ffd166, #f6a700); }
        .insight-card.approved .progress span { background: linear-gradient(135deg, #2ec4b6, #1cae9c); }
        .insight-card.risk .progress span { background: linear-gradient(135deg, #ef476f, #d42552); }

        .content-grid {
            display: grid;
            grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
            gap: clamp(18px, 4vw, 28px);
        }

        .panel {
            background: var(--card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            padding: clamp(22px, 4vw, 32px);
            display: grid;
            gap: 24px;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        .panel-header h3 {
            font-size: 1.15rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .panel-header h3 i { color: #9eb8ff; }

        .panel-subtitle { font-size: 0.9rem; color: var(--text-muted); }

        .status-list { display: grid; gap: 18px; }

        .status-row {
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: 18px;
        }

        .status-pill {
            padding: 8px 14px;
            border-radius: 999px;
            font-size: 0.85rem;
            font-weight: 600;
            background: rgba(255,255,255,0.08);
        }

        .status-row .progress { height: 8px; }

        .stat-note { font-size: 0.85rem; color: var(--text-muted); }

        .alert-stack { display: grid; gap: 16px; }

        .alert-card {
            background: rgba(239,71,111,0.12);
            border: 1px solid rgba(239,71,111,0.25);
            padding: 18px 20px;
            border-radius: var(--radius-md);
            display: grid;
            gap: 8px;
        }

        .alert-card.safe { background: rgba(46,196,182,0.12); border-color: rgba(46,196,182,0.24); }
        .alert-card.warning { background: rgba(255,209,102,0.12); border-color: rgba(255,209,102,0.24); }

        .alert-title { font-weight: 600; font-size: 0.95rem; display: flex; align-items: center; gap: 10px; }
        .alert-desc { font-size: 0.85rem; color: var(--text-muted); }

        .actions-panel {
            background: var(--card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            padding: clamp(22px, 4vw, 32px);
            display: grid;
            gap: 22px;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 18px;
        }

        .action-tile {
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: var(--radius-md);
            padding: 18px 20px;
            display: grid;
            gap: 10px;
            transition: transform 0.25s ease, border 0.25s ease;
        }

        .action-tile:hover { transform: translateY(-4px); border-color: rgba(76,130,255,0.35); }

        .tile-title { font-weight: 600; font-size: 0.95rem; }
        .tile-desc { font-size: 0.82rem; color: var(--text-muted); }

        .tile-link { font-size: 0.8rem; font-weight: 600; color: #b8c6ff; display: inline-flex; align-items: center; gap: 8px; }

        .badge { font-size: 0.75rem; padding: 4px 10px; border-radius: 999px; background: rgba(255,255,255,0.08); color: var(--text-muted); }

        @media (max-width: 1100px) {
            .app-shell { grid-template-columns: 1fr; }
            .sidebar { position: sticky; top: 16px; }
        }

        @media (max-width: 768px) {
            body { padding: 16px; }
            .page-header { padding: 24px; }
            .content-grid { grid-template-columns: 1fr; }
            .header-actions { width: 100%; }
            .header-btn { flex: 1; justify-content: center; }
        }

        @media (max-width: 540px) {
            .insights-grid { grid-template-columns: 1fr; }
            .sidebar { padding: 24px 20px; }
            .nav-link { grid-template-columns: auto 1fr; }
            .nav-count { justify-self: flex-end; }
        }
    </style>
</head>
<body>
    <div class="app-shell">
        <aside class="sidebar">
            <div class="brand">
                <div class="brand-icon"><i class="fa-solid fa-shield-halved"></i></div>
                <h1>CRIMAP Officer</h1>
            </div>

            <div class="nav-section">
                <span class="nav-label">navigate</span>
                <a class="nav-link" href="/dashboard">
                    <i class="fa-solid fa-gauge"></i>
                    <span>Admin Overview</span>
                    <span class="nav-count">Home</span>
                </a>
                <a class="nav-link" data-active="true" href="{{ url_for('loan_officer_dashboard') }}">
                    <i class="fa-solid fa-briefcase"></i>
                    <span>Loan Officer Hub</span>
                    <span class="nav-count">Live</span>
                </a>
                <a class="nav-link" href="/loans">
                    <i class="fa-solid fa-file-invoice-dollar"></i>
                    <span>Loan Pipeline</span>
                    <span class="nav-count">{{ pending_loans }} pending</span>
                </a>
                <a class="nav-link" href="/clients">
                    <i class="fa-solid fa-users"></i>
                    <span>Client Directory</span>
                    <span class="nav-count">View</span>
                </a>
                <a class="nav-link" href="/behavior-monitoring">
                    <i class="fa-solid fa-chart-line"></i>
                    <span>Behavior Monitoring</span>
                    <span class="nav-count">{{ high_risk_loans }} alerts</span>
                </a>
                <a class="nav-link" href="{{ url_for('crb_dashboard') }}">
                    <i class="fa-solid fa-magnifying-glass-chart"></i>
                    <span>CRB Intelligence</span>
                    <span class="nav-count">Check</span>
                </a>
                <a class="nav-link" href="/interventions">
                    <i class="fa-solid fa-handshake-angle"></i>
                    <span>Interventions Desk</span>
                    <span class="nav-count">Act</span>
                </a>
                <a class="nav-link" href="/reports">
                    <i class="fa-solid fa-chart-column"></i>
                    <span>Portfolio Reports</span>
                    <span class="nav-count">Export</span>
                </a>
                <a class="nav-link" href="{{ url_for('risk_analyst_dashboard') }}">
                    <i class="fa-solid fa-brain"></i>
                    <span>Risk Analysis</span>
                    <span class="nav-count">Collaborate</span>
                </a>
                <a class="nav-link" href="/logout">
                    <i class="fa-solid fa-arrow-right-from-bracket"></i>
                    <span>Logout</span>
                    <span class="nav-count">Exit</span>
                </a>
            </div>

            <div class="sidebar-footer">
                <strong>{{ total_loans }}</strong> portfolio files under management
            </div>
        </aside>

        <main class="main">
            <section class="page-header">
                <div class="header-grid">
                    <div class="header-title">
                        <h2>Loan Officer Workspace</h2>
                        <p>Welcome back, <strong>{{ username }}</strong>. Track performance, prioritize follow-ups, and keep approvals moving.</p>
                    </div>
                    <div class="header-meta">
                        <span class="role-chip"><i class="fa-solid fa-user-shield"></i> Loan Officer</span>
                    </div>
                </div>

                <div class="header-actions">
                    <a class="header-btn primary" href="/loans"><i class="fa-solid fa-magnifying-glass-dollar"></i> Review Applications</a>
                    <a class="header-btn" href="/behavior-monitoring"><i class="fa-solid fa-bolt"></i> Monitor Activity</a>
                    <a class="header-btn" href="/reports"><i class="fa-solid fa-download"></i> Export Snapshot</a>
                </div>
            </section>

            <section class="insights-grid">
                <article class="insight-card total reveal">
                    <div class="insight-header">
                        <div>
                            <span class="insight-title">total applications</span>
                            <div class="insight-value">{{ total_loans }}</div>
                        </div>
                        <div class="insight-icon"><i class="fa-solid fa-layer-group"></i></div>
                    </div>
                    <div class="insight-meta">
                        <span>Portfolio footprint</span>
                        <span class="badge">100%</span>
                    </div>
                    <div class="progress"><span style="--percent: 100%;"></span></div>
                </article>

                <article class="insight-card pending reveal">
                    {% set pending_percent = ((pending_loans / total_loans) * 100)|round(1) if total_loans else 0 %}
                    <div class="insight-header">
                        <div>
                            <span class="insight-title">awaiting decision</span>
                            <div class="insight-value">{{ pending_loans }}</div>
                        </div>
                        <div class="insight-icon"><i class="fa-solid fa-hourglass-half"></i></div>
                    </div>
                    <div class="insight-meta">
                        <span>Queue load</span>
                        <span>{{ pending_percent }}%</span>
                    </div>
                    <div class="progress"><span style="--percent: {{ pending_percent }}%;"></span></div>
                </article>

                <article class="insight-card approved reveal">
                    {% set approval_rate = ((approved_loans / total_loans) * 100)|round(1) if total_loans else 0 %}
                    <div class="insight-header">
                        <div>
                            <span class="insight-title">approved this cycle</span>
                            <div class="insight-value">{{ approved_loans }}</div>
                        </div>
                        <div class="insight-icon"><i class="fa-solid fa-circle-check"></i></div>
                    </div>
                    <div class="insight-meta">
                        <span>Approval rate</span>
                        <span>{{ approval_rate }}%</span>
                    </div>
                    <div class="progress"><span style="--percent: {{ approval_rate }}%;"></span></div>
                </article>

                <article class="insight-card risk reveal">
                    {% set risk_ratio = ((high_risk_loans / approved_loans) * 100)|round(1) if approved_loans else 0 %}
                    <div class="insight-header">
                        <div>
                            <span class="insight-title">high risk watch</span>
                            <div class="insight-value">{{ high_risk_loans }}</div>
                        </div>
                        <div class="insight-icon"><i class="fa-solid fa-radiation"></i></div>
                    </div>
                    <div class="insight-meta">
                        <span>Share of approvals</span>
                        <span>{{ risk_ratio }}%</span>
                    </div>
                    <div class="progress"><span style="--percent: {{ risk_ratio }}%;"></span></div>
                </article>
            </section>

            <section class="content-grid">
                <article class="panel reveal">
                    <div class="panel-header">
                        <div>
                            <h3><i class="fa-solid fa-route"></i> Pipeline Momentum</h3>
                            <p class="panel-subtitle">Keep every stage moving with clear workload priorities.</p>
                        </div>
                    </div>
                    <div class="status-list">
                        <div class="status-row">
                            <span class="status-pill">Pending queue</span>
                            <div class="progress"><span style="--percent: {{ pending_percent }}%;"></span></div>
                            <span class="badge">{{ pending_loans }}</span>
                        </div>
                        <div class="status-row">
                            <span class="status-pill">Approved</span>
                            <div class="progress"><span style="--percent: {{ approval_rate }}%;"></span></div>
                            <span class="badge">{{ approved_loans }}</span>
                        </div>
                        <div class="status-row">
                            {% set rejection_rate = ((rejected_loans / total_loans) * 100)|round(1) if total_loans else 0 %}
                            <span class="status-pill">Rejected</span>
                            <div class="progress"><span style="--percent: {{ rejection_rate }}%;"></span></div>
                            <span class="badge">{{ rejected_loans }}</span>
                        </div>
                    </div>
                    <p class="stat-note">Tip: Aim to keep pending queue under 35% to speed up approvals.</p>
                </article>

                <article class="panel reveal">
                    <div class="panel-header">
                        <div>
                            <h3><i class="fa-solid fa-triangle-exclamation"></i> Risk & Alerts</h3>
                            <p class="panel-subtitle">Identify the segments that need immediate review.</p>
                        </div>
                    </div>
                    <div class="alert-stack">
                        <div class="alert-card">
                            <div class="alert-title"><i class="fa-solid fa-fire"></i> High-risk approvals</div>
                            <p class="alert-desc">{{ high_risk_loans }} approved accounts flagged with behavior score below 40. Coordinate with the risk team for proactive outreach.</p>
                        </div>
                        <div class="alert-card warning">
                            <div class="alert-title"><i class="fa-solid fa-hourglass-start"></i> Pending backlog</div>
                            <p class="alert-desc">{{ pending_loans }} applications are awaiting next action. Focus on fresh submissions < 48h old to maintain SLA.</p>
                        </div>
                        <div class="alert-card safe">
                            <div class="alert-title"><i class="fa-solid fa-circle-check"></i> Approval health</div>
                            <p class="alert-desc">Approval rate stands at {{ approval_rate }}%. Keep momentum by closing warm files and triggering disbursement workflows early.</p>
                        </div>
                    </div>
                </article>
            </section>

            <section class="actions-panel reveal">
                <div class="panel-header">
                    <div>
                        <h3><i class="fa-solid fa-bolt"></i> Quick Playbook</h3>
                        <p class="panel-subtitle">Jump straight into the next best action.</p>
                    </div>
                </div>
                <div class="actions-grid">
                    <a class="action-tile" href="/loans">
                        <div class="tile-title">Prioritize reviews</div>
                        <p class="tile-desc">Filter by newest submissions to keep response times tight.</p>
                        <span class="tile-link">Open loan queue <i class="fa-solid fa-arrow-right"></i></span>
                    </a>
                    <a class="action-tile" href="/behavior-monitoring">
                        <div class="tile-title">Monitor borrower health</div>
                        <p class="tile-desc">Track repayment behavior shifts before they escalate.</p>
                        <span class="tile-link">Go to monitoring <i class="fa-solid fa-arrow-right"></i></span>
                    </a>
                    <a class="action-tile" href="{{ url_for('crb_dashboard') }}">
                        <div class="tile-title">Run CRB checks</div>
                        <p class="tile-desc">Validate credit records for pending approvals and renewals.</p>
                        <span class="tile-link">Launch CRB desk <i class="fa-solid fa-arrow-right"></i></span>
                    </a>
                    <a class="action-tile" href="/interventions">
                        <div class="tile-title">Schedule interventions</div>
                        <p class="tile-desc">Assign follow-ups or restructures for struggling borrowers.</p>
                        <span class="tile-link">Manage cases <i class="fa-solid fa-arrow-right"></i></span>
                    </a>
                </div>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const revealItems = document.querySelectorAll('.reveal');
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('show');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.2 });

            revealItems.forEach(item => {
                item.style.opacity = '0';
                item.style.transform = 'translateY(24px)';
                observer.observe(item);
            });
        });
    </script>

    <style>
        .reveal.show { opacity: 1 !important; transform: translateY(0) !important; transition: opacity 0.6s ease, transform 0.6s ease; }
    </style>
</body>
</html>