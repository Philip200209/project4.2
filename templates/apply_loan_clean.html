<!DOCTYPE html>
<html>
<head>
    <title>Apply for Loan - CRIMAP</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
        }
        .card { 
            background: white; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .form-section { 
            margin-bottom: 30px; 
            padding-bottom: 20px; 
            border-bottom: 1px solid #eee; 
        }
        .form-section h4 { 
            color: #007bff; 
            margin-bottom: 15px; 
        }
        .form-group { 
            margin-bottom: 15px; 
        }
        label { 
            display: block; 
            margin-bottom: 5px; 
            font-weight: bold; 
            color: #333; 
        }
        input, select, textarea { 
            width: 100%; 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 5px; 
            font-size: 14px; 
            box-sizing: border-box;
        }
        input:focus, select:focus, textarea:focus { 
            border-color: #007bff; 
            outline: none; 
        }
        .btn { 
            background: #007bff; 
            color: white; 
            padding: 12px 25px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 16px; 
            width: 100%;
        }
        .btn:hover { 
            background: #0056b3; 
        }
        .info-box { 
            background: #e3f2fd; 
            padding: 15px; 
            border-radius: 5px; 
            margin-bottom: 20px; 
        }
        .required { 
            color: red; 
        }
        small { 
            color: #666; 
            font-size: 12px; 
            display: block;
            margin-top: 5px;
        }
        .flash-messages {
            margin-bottom: 20px;
        }
        .flash-success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #c3e6cb;
        }
        .flash-error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #f5c6cb;
        }
        .back-link {
            text-align: center;
            margin-top: 20px;
        }
        .crb-notice {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìã Apply for Loan</h1>
        
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <div class="info-box">
            <h3>üìù Application Guidelines</h3>
            <p>‚úì Ensure all information is accurate and complete</p>
            <p>‚úì Loan decisions are typically made within 2-3 business days</p>
            <p>‚úì You'll be notified via email about your application status</p>
            <p>‚úì Interest rates range from 8% to 15% based on risk assessment</p>
            <p>‚úì All fields marked with <span class="required">*</span> are required</p>
            <p>‚úì CRB check will be performed using your ID Number</p>
        </div>

        <div class="card">
            <form method="POST" action="/loans/apply">
                
                <!-- Personal Information -->
                <div class="form-section">
                    <h4>üë§ Personal Information</h4>
                    
                    <div class="form-group">
                        <label>National ID Number <span class="required">*</span></label>
                        <input type="text" name="national_id" placeholder="e.g., 12345678" required maxlength="20">
                        <small>Your National ID number (used for CRB check)</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Phone Number <span class="required">*</span></label>
                        <input type="tel" name="phone_number" placeholder="e.g., +254712345678" required>
                        <small>Format: +254712345678</small>
                    </div>
                </div>

                <!-- Loan Details -->
                <div class="form-section">
                    <h4>üí∞ Loan Details</h4>
                    
                    <div class="form-group">
                        <label>Loan Amount (KSh) <span class="required">*</span></label>
                        <input type="number" name="loan_amount" placeholder="e.g., 50000" min="1000" max="1000000" step="1000" required>
                        <small>Amount between KSh 1,000 and KSh 1,000,000</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Loan Term (Months) <span class="required">*</span></label>
                        <select name="loan_term" required>
                            <option value="">Select term</option>
                            <option value="6">6 months</option>
                            <option value="12">12 months</option>
                            <option value="18">18 months</option>
                            <option value="24">24 months</option>
                            <option value="36">36 months</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Loan Purpose <span class="required">*</span></label>
                        <select name="loan_purpose" required>
                            <option value="">Select purpose</option>
                            <option value="Business">Business Expansion</option>
                            <option value="Education">Education Fees</option>
                            <option value="Medical">Medical Expenses</option>
                            <option value="Personal">Personal Use</option>
                            <option value="Home">Home Improvement</option>
                            <option value="Vehicle">Vehicle Purchase</option>
                            <option value="Agriculture">Agriculture</option>
                            <option value="Emergency">Emergency</option>
                        </select>
                    </div>
                </div>

                <!-- CRB Consent -->
                <div class="form-section">
                    <div class="crb-notice">
                        <strong>üìä Credit Reference Bureau (CRB) Check</strong>
                        <p>By proceeding, you consent to a credit check with licensed Credit Reference Bureaus in Kenya. This helps us assess your loan application and comply with regulatory requirements.</p>
                    </div>
                </div>

                <!-- Consent -->
                <div class="form-section">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" name="terms_accepted" required>
                            I agree to the Terms and Conditions, Privacy Policy, and CRB Check <span class="required">*</span>
                        </label>
                    </div>
                </div>

                <button type="submit" class="btn">‚úÖ Submit Application</button>
                
                <div class="back-link">
                    <a href="/borrower-dashboard" style="color: #007bff; text-decoration: none;">‚Üê Back to Dashboard</a>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Simple form validation
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            
            form.addEventListener('submit', function(e) {
                let isValid = true;
                
                // Check all required fields
                const requiredFields = form.querySelectorAll('[required]');
                requiredFields.forEach(field => {
                    if (!field.value || (field.type === 'checkbox' && !field.checked)) {
                        isValid = false;
                        field.style.borderColor = 'red';
                    } else {
                        field.style.borderColor = '#ddd';
                    }
                });
                
                // Validate loan amount
                const amount = parseFloat(document.querySelector('input[name="loan_amount"]').value);
                if (amount < 1000 || amount > 1000000) {
                    isValid = false;
                    alert('Loan amount must be between KSh 1,000 and KSh 1,000,000');
                }
                
                // Validate national ID
                const nationalId = document.querySelector('input[name="national_id"]').value;
                if (nationalId.length < 6) {
                    isValid = false;
                    alert('Please enter a valid National ID');
                }
                
                // Validate phone number
                const phone = document.querySelector('input[name="phone_number"]').value;
                if (!phone.startsWith('+254')) {
                    isValid = false;
                    alert('Phone number must start with +254');
                }
                
                if (!isValid) {
                    e.preventDefault();
                }
            });
            
            // Auto-format phone number
            const phoneInput = document.querySelector('input[name="phone_number"]');
            phoneInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.startsWith('254')) {
                    value = '+' + value;
                } else if (value.length > 0 && !value.startsWith('+254')) {
                    value = '+254' + value.replace(/^0+/, '');
                }
                e.target.value = value.substring(0, 13);
            });
        });
    </script>
</body>
</html>
